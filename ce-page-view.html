<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="../iron-pages/iron-pages.html">

<!--
`ce-page-view`
Custom Element to help managing pages using polymer.

@demo demo/index.html 
-->

<dom-module id="ce-page-view">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>

		<app-route
			route="{{route}}"
			pattern="/:page"
			data="{{routeData}}"
			tail="{{subroute}}">
		</app-route>
		
		<iron-pages attr-for-selected="name" selected="[[page]]" class="flex">
			<content></content>
		</iron-pages>

	</template>

	<script>
		Polymer({

			is: 'ce-page-view',

			properties: {
				/**
				 * Route object got from polymer's `app-location` ou `ce-page-view`
				 */
				route: {
					type: Object,
					observer: '_changeRoute',
					notify: true
				},
				/**
				 * Subroute object returned
				 */
				subroute: {
					type: Object,
					notify: true
				},
				/**
				 * Page url string
				 */
				url: {
					type: String,
					observer: '_changePage',
					notify: true
				},
				/**
				 * Pages components directory
				 */
				componentsDir: {
					type: String,
					value: 'pages/'
				},
				/**
				 * Home name
				 */
				home: {
					type: String,
					value: '__home__'
				},
				/**
				 * Dite json object
				 */
				siteObject: {
					type: Object
				}
			},

			_changeRoute: function(){
				//TODO: remove
				this.set('url', this.home)
				return

				if(!this.routeData.page){
					this.set('url', this.home)
				}else {
					this.set('url', this.routeData.page)
				}
			},
			_changePage: function(url) {
				// Load page import on demand. Show 404 page if fails
				var resolvedPageUrl = this.resolveUrl(this.componentsDir + this.siteObject[url] + '.html')
				//TODO: see if is a polymer instance
				this.importHref(resolvedPageUrl, null, this._showPage404, true)
			},

			_showPage404: function(page) {
				// Load 404 page import on demand.
				var resolvedPageUrl = this.resolveUrl(this.componentsDir + 'error-404.html')
				//TODO: see if is a polymer instance
				this.importHref(resolvedPageUrl, null, function(){
					console.log('Define an error-404.html page, please');
				}, true)
			},


		})
	</script>
</dom-module>
